USE CPPDB

DROP TABLE CUSTOMERS;

CREATE TABLE CUSTOMERS(
CUSTNO		VARCHAR(5) PRIMARY KEY NOT NULL,
FIRSTNAME	VARCHAR(30) NOT NULL DEFAULT(''),
LASTNAME	VARCHAR(30) NOT NULL DEFAULT(''),
CITY		VARCHAR(30) NULL DEFAULT(''),
ADDR		VARCHAR(30) NULL DEFAULT(''),
PHONE		VARCHAR(12) NULL DEFAULT('')
);

INSERT INTO CUSTOMERS VALUES('00001', 'Peter', 'Park', 'Oakland', '7 Manito Ave', '111-222-2222');
INSERT INTO CUSTOMERS VALUES('00002', 'Paul', 'Park', 'Oakland', '8 Manito Ave', '112-333-3333');
INSERT INTO CUSTOMERS VALUES('00003', 'Lydia', 'Park', 'Oakland', '9 Manito Ave', '113-444-4444');
INSERT INTO CUSTOMERS VALUES('00004', 'JOseph', 'Park', 'Oakland', '10 Manito Ave', '114-555-5555');

DROP TABLE ORDERHISTORY;

CREATE TABLE ORDERHISTORY(
ORDERNO		INT PRIMARY KEY NOT NULL,
CUSTNO		INT NOT NULL,
ITEM		VARCHAR(20) NOT NULL DEFAULT(''),
QUANTITY	INT,
UNITPRICE	DECIMAL,
REMARKS		VARCHAR(30) )

---------------------------------------------------------------------------------------
-- [PROCEDURE]: PQ_CRTTBL_ORDERHISTORY
-- ORDER HISTORY TABLE을 만든다
---------------------------------------------------------------------------------------
IF EXISTS(SELECT * FROM SYS.PROCEDURES WHERE NAME = 'PQ_CRTTBL_ORDERHISTORY' AND TYPE = 'P' )
  DROP PROC PQ_CRTTBL_ORDERHISTORY
GO
CREATE PROC PQ_CRTTBL_ORDERHISTORY
AS
BEGIN
	CREATE TABLE ORDERHISTORY(
	ORDERNO		INT PRIMARY KEY NOT NULL,
	CUSTNO		INT NOT NULL,
	ITEM		VARCHAR(20) NOT NULL DEFAULT(''),
	QUANTITY	INT,
	UNITPRICE	DECIMAL,
	REMARKS		VARCHAR(30) )
END
GO


---------------------------------------------------------------------------------------
-- [PROCEDURE]: PQ_CUSTOMERLIST
-- QUERY ALL CUSTOMER LIST
---------------------------------------------------------------------------------------
IF EXISTS(SELECT * FROM SYS.PROCEDURES WHERE NAME = 'PQ_CUSTOMERLIST' AND TYPE = 'P' )
  DROP PROC PQ_CUSTOMERLIST
GO
CREATE PROC PQ_CUSTOMERLIST
AS
BEGIN
	SELECT * FROM CUSTOMERS
END
GO

---------------------------------------------------------------------------------------
-- [PROCEDURE]: PQ_CUSTOMERINFO
-- QUERY CUSTOMER INFO BY CUSTNO
---------------------------------------------------------------------------------------
IF EXISTS(SELECT * FROM SYS.PROCEDURES WHERE NAME = 'PQ_CUSTOMERINFO' AND TYPE = 'P' )
  DROP PROC PQ_CUSTOMERINFO
GO
CREATE PROC PQ_CUSTOMERINFO
(@CUSTNO VARCHAR(6))
AS
BEGIN
	SELECT * FROM CUSTOMERS WHERE CUSTNO = @CUSTNO
END
GO